<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <title>FindEat - home</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>


  <!-- Navbar Bootstrap -->
  <nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">FindEat</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
  <div class="navbar-nav ms-auto">
          <a class="nav-link">Logout</a>
          <a class="nav-link">Profilo</a>
        </div>
      </div>
    </div>
  </nav>

  <div id="layout">
    <aside id="leftPanel" aria-live="polite">
      <!-- Spinner locale pannello sinistro (lista/dettagli) -->
      <div id="leftSpinner" class="panel-spinner hidden" aria-live="polite" aria-label="Caricamento lista">
        <div class="spinner"></div>
      </div>
      <!-- Barra filtri -->
      <div id="filtersBar" class="filters-grid">
        <div class="filters-title-row">
          <span class="filters-title">Filtri</span>
        </div>
        <div class="filters-row filters-row-1">
          <label class="filter-label">
            <input type="checkbox" id="fltLiked" />
            <span class="filter-text">Solo liked</span>
          </label>
          <label class="filter-label">
            <input type="checkbox" id="fltReviewed" />
            <span class="filter-text">Solo recensiti</span>
          </label>
        </div>
        <div class="filters-row filters-row-2">
            <label class="filter-label" style="width:100%; justify-content:center;">
                <span class="filter-text" style="margin-right:10px;">Distanza</span>
                <input type="range" id="fltDistance" min="1" max="10" step="1" value="5" aria-label="Distanza in chilometri" />
                <span id="fltDistanceValue" class="filter-text" style="margin-left:10px; white-space:nowrap;">5 km</span>
            </label>
        </div>
        <div class="filters-row filters-row-3">
          <button id="resetFiltersBtn" type="button" class="filters-btn" disabled>Ripristina filtri</button>
          <button id="applyFiltersBtn" type="button" class="filters-btn" disabled>Applica filtri</button>
        </div>
      </div>
      <!-- Vista lista (default quando nessun ristorante √® selezionato) -->
      <div id="listView"></div>

      <!-- Vista dettagli (mostrata quando si seleziona un ristorante) -->
      <div id="detailView" class="hidden">
        <div class="dp-photo-area">
          <div class="hero-overlay">
            <div class="hero-top-bar">
              <button id="dpBackToList" type="button" class="back-btn hero-btn" aria-label="Torna alla lista">‚Üê</button>
              <button id="dpLikeBtn" class="like-btn hero-btn" title="Mi piace">‚ô°</button>
            </div>
            <h2 id="dpTitle" class="hero-title"></h2>
          </div>
          <img id="dpCurrentPhoto" src="" alt="Foto ristorante" />
          <p id="dpNoPhotoMsg" style="display:none;">üòï Nessuna foto trovata per questo ristorante.</p>
          <button id="dpPrevPhoto" class="carousel-btn" type="button" aria-label="Foto precedente">&#10094;</button>
          <button id="dpNextPhoto" class="carousel-btn" type="button" aria-label="Foto successiva">&#10095;</button>
        </div>

        <div id="dpDetails" class="details"></div>

        <div class="dp-reviews reviews-container" id="dpReviewsContainer">
          <div class="reviews-header" id="dpReviewsHeader">
            <span class="section-label" id="dpReviewsLabel">Recensioni</span>
            <span id="dpRatingNumber" class="rating-number"></span>
            <span id="dpStars" class="stars"></span>
            <span id="dpReviewsCount" class="reviews-count"></span>
            <button id="dpAddReviewBtn" class="add-review-btn" type="button" aria-label="Aggiungi recensione">Aggiungi recensione</button>
          </div>
          <div class="reviews-list" id="dpReviewsList" aria-hidden="true"></div>
        </div>
      </div>
    </aside>

    <div id="map" role="region" aria-label="Mappa dei ristoranti">
      <div id="status">üìç Recupero la tua posizione...</div>
      <div id="mapSpinner" class="panel-spinner hidden" aria-live="polite" aria-label="Caricamento mappa">
        <div class="spinner"></div>
      </div>
    </div>
  </div>

  <!-- Vista lista (default quando nessun ristorante √® selezionato) -->
  <div id="listView"></div>

  <!-- Template per un elemento della lista (usato da HomeView.renderList) -->
  <template id="list-item-template">
    <div class="list-item">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:8px;">
        <div>
          <h3 class="li-title" data-li-name style="margin:0;"></h3>
          <div class="li-meta" data-li-meta></div>
        </div>
        <div style="display:flex; gap:8px;">
          <button class="back-btn li-details" title="Vedi dettagli" aria-label="Vedi dettagli">Dettagli</button>
        </div>
      </div>
    </div>
  </template>

  <!-- Template: details chips + info + hours + editorial -->
  <template id="dp-chips-template">
    <section class="chips-section"></section>
  </template>

  <template id="dp-info-card-template">
    <section class="card info-card">
      <h3 class="card-title">Info</h3>
      <div class="facts-grid"></div>
    </section>
  </template>

  <template id="dp-hours-card-template">
    <section class="card hours-card">
      <div class="hours-block"></div>
    </section>
  </template>

  <template id="dp-editorial-template">
    <section class="card editorial-card"><p class="editorial-text"></p></section>
  </template>

  <!-- Template singola recensione -->
  <template id="dp-review-item-template">
    <div class="review">
      <div class="review-header">
        <div class="review-id">
          <div class="review-avatar-wrapper"></div>
          <div class="review-header-text">
            <div class="review-author-wrap"></div>
            <div class="review-time"></div>
          </div>
        </div>
        <div class="review-stars-wrap"></div>
      </div>
      <div class="review-text"></div>
    </div>
  </template>

  <!-- Template "nessuna recensione" -->
  <template id="dp-no-reviews-template">
    <div class="review">Nessuna recensione disponibile.</div>
  </template>

  <!-- Template add-review form -->
  <template id="dp-add-review-template">
    <form id="addReviewForm" class="add-review-form" onsubmit="return false;">
      <div class="arf-row"><label>Nome</label><input type="text" id="arfName" value="nome" disabled /></div>
      <div class="arf-row">
        <label>Voto</label>
        <div class="arf-stars" id="arfStars" role="radiogroup" aria-label="Seleziona voto in stelle">
          <button type="button" class="arf-star" data-value="1" aria-label="1 stelle">‚òÖ</button>
          <button type="button" class="arf-star" data-value="2" aria-label="2 stelle">‚òÖ</button>
          <button type="button" class="arf-star" data-value="3" aria-label="3 stelle">‚òÖ</button>
          <button type="button" class="arf-star" data-value="4" aria-label="4 stelle">‚òÖ</button>
          <button type="button" class="arf-star" data-value="5" aria-label="5 stelle">‚òÖ</button>
        </div>
        <input type="number" id="arfRating" min="1" max="5" step="1" placeholder="1-5" inputmode="numeric" aria-label="Voto numerico" />
      </div>
      <div class="arf-row"><label>Commento (facoltativo)</label><textarea id="arfText" rows="3" placeholder="Scrivi qui la tua esperienza (opzionale)"></textarea></div>
      <div class="arf-actions"><button type="button" id="arfCancel" class="btn-secondary">Annulla</button><button type="button" id="arfSave" class="btn-primary" disabled>Salva</button></div>
    </form>
  </template>

  <!-- Librerie -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Entry point modulare -->
  <script type="module">
      import { GOOGLE_MAPS_API_KEY } from '../config.js';

      const script = document.createElement('script');
      script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_API_KEY}&libraries=places`;
      script.async = true;
      script.defer = true;
      document.head.appendChild(script);
  </script>
</body>
</html>
